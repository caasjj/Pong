<!DOCTYPE html>
<html>
<head>
<title></title>
<link rel="stylesheet" type="text/css" href="pong.css">
<script src="../HLU/Frameworks/js/jquery-2.0.2.js" type="text/javascript"></script>
<script>
$(function () {

    gameObj = {
        tInterval: 10,
        init: function (width, height) {
            gameObj.canvasWidth = width || 800;
            gameObj.canvasHeight = height || 600;
            $('canvas').attr('width', gameObj.canvasWidth).attr('height', gameObj.canvasHeight);
        },
        board: {
            getWidth: function () {
                return gameObj.canvasWidth;
            },
            getHeight: function () {
                return gameObj.canvasHeight;
            },
            getCtx: function () {
                var canvas = document.getElementById('canvas');
                return canvas.getContext('2d');
            }
        }

    };

    gameObj.paddle = {
        xPos: 375,
        yPos: 0,
        xDim: 100,
        yDim: 5,
        color: {
            r: 200,
            g: 0,
            b: 0,
            a: 1
        },
        velocity: 0,
        clear: function (b) {
            var c = b.getCtx();
            c.clearRect(this.xPos, this.yPos, this.xDim, this.yDim);
        },
        draw: function (b) {
            var c = b.getCtx();
            c.fillStyle = "rgba(" +
                    this.color.r + "," +
                    this.color.g + "," +
                    this.color.b + "," +
                    this.color.a + ")";
            c.fillRect(this.xPos, this.yPos, this.xDim, this.yDim);
        },
        run: function () {
            this.move(this.velocity * gameObj.tInterval);
        },
        move: function (x) {
            this.clear(gameObj.board);
            this.xPos += x;
            if (this.xPos < 0) {
                this.xPos = 0;
            }
            if (this.xPos > (gameObj.board.getWidth() - this.xDim)) {
                this.xPos = gameObj.board.getWidth() - this.xDim;
            }
            this.draw(gameObj.board);
        },
        setColor: function (r, g, b, a) {
            this.color.r = r;
            this.color.g = g;
            this.color.b = b;
            this.color.a = a;
        }
    };

    gameObj.ball = {
        xPos: 400,
        yPos: 15,
        radius: 10,
        velocity: {
            xVel: -5,
            yVel: 5
        },
        color: {
            r: 0,
            g: 125,
            b: 0,
            a: 1
        },
        run: function () {
            this.move(this.velocity.xVel * gameObj.tInterval, this.velocity.yVel * gameObj.tInterval);
        },
        move: function (x, y) {
            this.clear(gameObj.board);
            if ((this.xPos > this.radius) && (this.xPos < gameObj.board.getWidth() - this.radius)) {
                this.xPos += x;
            } else {
                if (this.xPos <= this.radius) {
                    this.xPos -= x;
                    this.velocity.xVel = Math.abs(this.velocity.xVel);
                } else {
                    this.xPos -= x;
                    this.velocity.xVel = -Math.abs(this.velocity.xVel);
                }
            }
            if( (this.yPos < gameObj.board.getHeight() - gameObj.wall.getWidth() - this.radius) &&
                    (!this.detectPaddleHit() ) ) {
                this.yPos += y;
            } else {
                if (gameObj.wall.isInHole(this.xPos, this.radius)) {
                    this.yPos += y;
                } else {
                    if (this.yPos >= gameObj.board.getHeight() - gameObj.wall.getWidth() - this.radius) {
                        this.yPos -= y;
                        this.velocity.yVel = -Math.abs(this.velocity.yVel);
                    } else {
                        this.yPos -= y;
                        this.velocity.yVel = Math.abs(this.velocity.yVel);
                    }

                }
            }
            this.draw(gameObj.board);
        },
        detectPaddleHit : function() {
                if (this.yPos > gameObj.paddle.yDim + this.radius) {
                    return false;
                } else {
                    if ( (this.xPos<=gameObj.paddle.xPos + gameObj.paddle.xDim) &&
                         (this.xPos>=gameObj.paddle.xPos)
                     ) {
                        return true;
                    } else {
                        return false;
                    }
                }
        },

        clear: function (b) {
            var c = b.getCtx();
            c.clearRect(this.xPos - this.radius, this.yPos - this.radius, this.radius * 2, this.radius * 2);
            c.fillStyle = 'white';
            c.fillRect(this.xPos - this.radius, this.yPos - this.radius, this.radius * 2, this.radius * 2);
        },
        draw: function (b) {
            var c = b.getCtx();
            c.fillStyle = "rgba(" +
                    this.color.r + "," +
                    this.color.g + "," +
                    this.color.b + "," +
                    this.color.a + ")";
            c.beginPath();
            c.arc(this.xPos, this.yPos, this.radius, 0, 2 * Math.PI, true);
            c.fill();
        }
    };

    gameObj.wall = {
        color: {
            r: 0,
            g: 0,
            b: 0,
            a: 1
        },
        pos: 'top',
        yDim: 5,
        hole: {
            left: 350,
            right: 450,
            score:[]
        },
        setColor: function (r, g, b, a) {
            this.color.r = r;
            this.color.g = g;
            this.color.b = b;
            this.color.a = a;
        },
        draw: function (b) {
            this.drawLeftWall(b);
            this.drawHole(b);
            this.drawRightWall(b);
        },
        drawLeftWall: function (b) {
            var c = b.getCtx();
            c.fillStyle = "rgba(" +
                    this.color.r + "," +
                    this.color.g + "," +
                    this.color.b + "," +
                    this.color.a + ")";

            c.fillRect(0, b.getHeight() - this.yDim, this.hole.left, this.yDim);
        },
        drawHole: function (b) {
            var c = b.getCtx();
            c.fillStyle = "rgba(" +
                    255 + "," +
                    255 + "," +
                    255 + "," +
                    1 + ")";
            c.fillRect(this.hole.left, b.getHeight() - this.yDim, this.hole.right - this.hole.left, this.yDim);
        },
        drawRightWall: function (b) {
            var c = b.getCtx();
            c.fillStyle = "rgba(" +
                    this.color.r + "," +
                    this.color.g + "," +
                    this.color.b + "," +
                    this.color.a + ")";
            c.fillRect(this.hole.right, b.getHeight() - this.yDim, b.getWidth() - this.hole.right, this.yDim);
        },
        getWidth: function () {
            return this.yDim;
        },
        isInHole: function (x, r) {
            return ( (x > this.hole.left + r) && (x < this.hole.right - r) );
        }
    };

    // Attach keyboard event handler
    $(document).keydown(function (e) {
        if (e.keyCode === 37) {
            gameObj.paddle.velocity = -0.50;
        }
        if (e.keyCode === 39) {
            gameObj.paddle.velocity = 0.50;
        }
        if (e.keyCode === 38) {
            gameObj.ball.move(-5, 5);
        }
        if (e.keyCode === 40) {
            gameObj.ball.move(5, 5);
        }
        if (e.keyCode === 13) {
            gameObj.ball.move(0, 0);
        }
    });

    $(document).keyup(function () {
        gameObj.paddle.velocity = 0;
    });

    // Draw the paddle
    gameObj.init(800, 600);
    gameObj.paddle.draw(gameObj.board);
    gameObj.wall.draw(gameObj.board);
    gameObj.ball.draw(gameObj.board);
    setInterval(function () {
        gameObj.ball.run.call(gameObj.ball);
        gameObj.paddle.run.call(gameObj.paddle);
    }, gameObj.tInterval);

})
;
</script>
</head>
<body>
<canvas id="canvas"></canvas>
</body>
</html>